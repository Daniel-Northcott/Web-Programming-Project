<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>User Login</title>
		<style>
			body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:#0f172a; color:#e5e7eb; margin:0; }
			.container { max-width: 420px; margin: 64px auto; padding: 0 16px; }
			.card { background:#111827; border:1px solid rgba(229,231,235,.06); border-radius:12px; padding:20px; }
			label { display:block; font-size:14px; color:#9ca3af; margin-bottom:6px; }
			input { width:100%; padding:10px 12px; border-radius:8px; border:1px solid rgba(229,231,235,.08); background:#0b1220; color:#e5e7eb; }
			.row { margin-bottom:14px; }
			.actions { display:flex; gap:10px; }
			button { cursor:pointer; padding:10px 14px; border-radius:8px; border:0; font-weight:600; }
			.primary { background:#22d3ee; color:#051923; }
			.secondary { background:#1f2937; color:#e5e7eb; border:1px solid rgba(229,231,235,.08); }
			.msg { margin-top:10px; font-size:14px; color:#9ca3af; }
			a { color:#22d3ee; text-decoration:none; }
		</style>
	</head>
	<body>
		<div class="container">
			<h1 style="margin:0 0 12px">Welcome back</h1>
			<p style="margin:0 0 20px;color:#9ca3af">Log in or create an account to save reviews.</p>
			<div class="card">
				<form id="authForm">
					<div class="row">
						<label for="email">Email</label>
						<input id="email" name="email" type="email" required />
					</div>
					<div class="row">
						<label for="password">Password</label>
						<input id="password" name="password" type="password" required />
					</div>
					<div class="actions">
						<button type="submit" class="primary" id="loginBtn">Login</button>
						<button type="button" class="secondary" id="registerBtn">Register</button>
						<a href="index.html" style="margin-left:auto;align-self:center;">Back to home</a>
					</div>
					<div class="msg" id="msg"></div>
				</form>
			</div>
		</div>
		<script>
			const form = document.getElementById('authForm');
			const msg = document.getElementById('msg');
			const loginBtn = document.getElementById('loginBtn');
			const registerBtn = document.getElementById('registerBtn');

			function setMessage(text, isError=false){
				msg.textContent = text;
				msg.style.color = isError ? '#fca5a5' : '#9ca3af';
			}

			async function post(url, data){
				const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
				const body = await res.json().catch(() => ({}));
				if(!res.ok) throw new Error(body.message || 'Request failed');
				return body;
			}

			form.addEventListener('submit', async (e) => {
				e.preventDefault();
				const email = form.email.value.trim();
				const password = form.password.value;
				try {
					setMessage('Signing in...');
					  const u = await post('/api/users/login', { email, password });
					  localStorage.setItem('userEmail', u.email);
					  setMessage('Logged in successfully');
					  // Redirect to home after login
					  window.location.href = 'index.html';
				} catch (err) {
					setMessage(err.message, true);
				}
			});

			registerBtn.addEventListener('click', async () => {
				const email = form.email.value.trim();
				const password = form.password.value;
				try {
					setMessage('Creating account...');
					await post('/api/users/register', { email, password });
					setMessage('Account created. You can now log in.');
				} catch (err) {
					setMessage(err.message, true);
				}
			});
		</script>
	</body>
	</html>
